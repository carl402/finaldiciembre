<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo - Sistema de Simulaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState, useEffect } = React;
        
        function App() {
            const [currentPage, setCurrentPage] = useState('login');
            const [user, setUser] = useState(null);
            const [loginData, setLoginData] = useState({email: '', password: ''});
            const [loginError, setLoginError] = useState('');
            
            const [projects, setProjects] = useState([]);
            const [users, setUsers] = useState([]);
            const [reports, setReports] = useState([]);
            const [deletedReports, setDeletedReports] = useState([]);
            const [newProject, setNewProject] = useState({name: '', description: '', status: 'active'});
            const [selectedProject, setSelectedProject] = useState(null);
            const [projectVariables, setProjectVariables] = useState([]);
            const [newVariable, setNewVariable] = useState({name: '', type: 'continua', distribution: 'normal', parameters: {}});
            const [simulationConfig, setSimulationConfig] = useState({iterations: 1000, randomSeed: null});
            const [newUser, setNewUser] = useState({firstName: '', lastName: '', email: '', password: '', role: 'analyst'});
            const [editingUser, setEditingUser] = useState(null);
            const [changingPassword, setChangingPassword] = useState(null);
            const [newPassword, setNewPassword] = useState('');
            const [searchProject, setSearchProject] = useState('');
            const [searchDate, setSearchDate] = useState('');
            const [viewingReport, setViewingReport] = useState(null);
            
            // Load data from API
            useEffect(() => {
                if (user) {
                    loadProjects();
                    loadUsers();
                    loadReports();
                }
            }, [user]);
            
            const loadProjects = async () => {
                try {
                    const response = await fetch('/api/projects');
                    if (response.ok) {
                        const data = await response.json();
                        setProjects(data);
                    }
                } catch (error) {
                    console.error('Error loading projects:', error);
                }
            };
            
            const loadUsers = async () => {
                try {
                    const response = await fetch('/api/users');
                    if (response.ok) {
                        const data = await response.json();
                        setUsers(data);
                    }
                } catch (error) {
                    console.error('Error loading users:', error);
                }
            };
            
            const loadReports = async () => {
                try {
                    const response = await fetch('/api/reports');
                    if (response.ok) {
                        const data = await response.json();
                        setReports(data);
                    }
                } catch (error) {
                    console.error('Error loading reports:', error);
                }
            };
            
            // Funci√≥n para ejecutar simulaci√≥n Monte Carlo
            const executeMonteCarloSimulation = (variables, config) => {
                const scenarios = [];
                const results = [];
                
                for (let i = 0; i < config.iterations; i++) {
                    const scenario = { iteration: i + 1, values: {} };
                    let result = 0;
                    
                    variables.forEach(variable => {
                        let value;
                        switch (variable.distribution) {
                            case 'normal':
                                value = normalRandom(50, 15);
                                break;
                            case 'uniforme':
                                value = Math.random() * 100;
                                break;
                            case 'triangular':
                                value = triangularRandom(10, 50, 90);
                                break;
                            default:
                                value = Math.random() * 100;
                        }
                        scenario.values[variable.name] = value;
                        result += value;
                    });
                    
                    scenario.result = result;
                    scenarios.push(scenario);
                    results.push(result);
                }
                
                const average = results.reduce((a, b) => a + b, 0) / results.length;
                const variance = results.reduce((a, b) => a + Math.pow(b - average, 2), 0) / results.length;
                const stdDev = Math.sqrt(variance);
                const sorted = results.sort((a, b) => a - b);
                const p50 = sorted[Math.floor(sorted.length * 0.5)];
                const p90 = sorted[Math.floor(sorted.length * 0.9)];
                
                return {
                    scenarios,
                    results,
                    metrics: { average, stdDev, variance, p50, p90, min: Math.min(...results), max: Math.max(...results) }
                };
            };
            
            const normalRandom = (mean, stdDev) => {
                const u1 = Math.random();
                const u2 = Math.random();
                const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                return z0 * stdDev + mean;
            };
            
            const triangularRandom = (min, mode, max) => {
                const u = Math.random();
                const f = (mode - min) / (max - min);
                if (u < f) {
                    return min + Math.sqrt(u * (max - min) * (mode - min));
                } else {
                    return max - Math.sqrt((1 - u) * (max - min) * (max - mode));
                }
            };
            
            const generateCharts = (simulationResults) => {
                const { results, metrics } = simulationResults;
                const bins = 10;
                const binSize = (metrics.max - metrics.min) / bins;
                const histogram = Array(bins).fill(0);
                
                results.forEach(value => {
                    const binIndex = Math.min(Math.floor((value - metrics.min) / binSize), bins - 1);
                    histogram[binIndex]++;
                });
                
                const densityCurve = histogram.map((count, i) => ({
                    x: metrics.min + (i + 0.5) * binSize,
                    y: count / (results.length * binSize)
                }));
                
                return {
                    histogram: {
                        bins: histogram,
                        labels: Array(bins).fill(0).map((_, i) => `${(metrics.min + i * binSize).toFixed(1)}-${(metrics.min + (i + 1) * binSize).toFixed(1)}`)
                    },
                    densityCurve
                };
            };
            
            const viewReport = (report) => {
                setViewingReport(report);
            };
            
            const deleteReport = async (reportId) => {
                try {
                    const response = await fetch(`/api/reports/${reportId}`, { method: 'DELETE' });
                    if (response.ok) {
                        const report = reports.find(r => r.id === reportId);
                        if (report) {
                            const deletedReport = {...report, deletedAt: new Date().toISOString()};
                            setDeletedReports([...deletedReports, deletedReport]);
                            setReports(reports.filter(r => r.id !== reportId));
                            alert('Reporte eliminado. Tienes 24 horas para recuperarlo.');
                        }
                    }
                } catch (error) {
                    console.error('Error deleting report:', error);
                }
            };
            
            const recoverReport = async (reportId) => {
                try {
                    const report = deletedReports.find(r => r.id === reportId);
                    if (report) {
                        const { deletedAt, ...cleanReport } = report;
                        const response = await fetch('/api/reports', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(cleanReport)
                        });
                        if (response.ok) {
                            setReports([...reports, cleanReport]);
                            setDeletedReports(deletedReports.filter(r => r.id !== reportId));
                            alert('Reporte recuperado exitosamente.');
                        }
                    }
                } catch (error) {
                    console.error('Error recovering report:', error);
                }
            };
            
            const viewProjectReport = (projectName) => {
                const projectReport = reports.find(r => r.project === projectName);
                if (projectReport) {
                    setCurrentPage('reportes');
                    setTimeout(() => viewReport(projectReport), 100);
                } else {
                    alert('No hay reportes generados para este proyecto.');
                }
            };
            
            const logout = () => {
                setUser(null);
                setCurrentPage('login');
                setLoginData({email: '', password: ''});
            };
            
            const downloadReport = async (report, format) => {
                try {
                    const response = await fetch(`/api/reports/${report.id}/download`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ format })
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${report.name}.${format}`;
                        a.click();
                        URL.revokeObjectURL(url);
                    } else {
                        alert('Error generando el documento');
                    }
                } catch (error) {
                    console.error('Error downloading report:', error);
                    alert('Error descargando el reporte');
                }
            };
            
            // Limpiar reportes eliminados despu√©s de 24 horas
            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    setDeletedReports(prev => prev.filter(report => {
                        const deletedTime = new Date(report.deletedAt);
                        const hoursDiff = (now - deletedTime) / (1000 * 60 * 60);
                        return hoursDiff < 24;
                    }));
                }, 60000);
                
                return () => clearInterval(interval);
            }, []);
            
            const handleLogin = async () => {
                try {
                    console.log('üîê Attempting login with:', loginData);
                    
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(loginData)
                    });
                    
                    console.log('üìû Response status:', response.status);
                    
                    if (response.ok) {
                        const userData = await response.json();
                        console.log('‚úÖ Login successful:', userData);
                        setUser(userData);
                        setCurrentPage('reportes');
                        setLoginError('');
                    } else {
                        const errorData = await response.json();
                        console.log('‚ùå Login failed:', errorData);
                        setLoginError('Credenciales inv√°lidas');
                    }
                } catch (error) {
                    console.error('‚ùå Login error:', error);
                    setLoginError('Error de conexi√≥n');
                }
            };
            
            const createProject = async () => {
                if (!newProject.name) return;
                
                try {
                    const response = await fetch('/api/projects', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({...newProject, responsibleUser: user?.id})
                    });
                    
                    if (response.ok) {
                        const project = await response.json();
                        setProjects([...projects, project]);
                        setNewProject({name: '', description: '', status: 'active'});
                    }
                } catch (error) {
                    console.error('Error creating project:', error);
                }
            };
            
            const deleteProject = async (projectId) => {
                try {
                    const response = await fetch(`/api/projects/${projectId}`, { method: 'DELETE' });
                    if (response.ok) {
                        setProjects(projects.filter(p => p.id !== projectId));
                    }
                } catch (error) {
                    console.error('Error deleting project:', error);
                }
            };
            
            const createUser = async () => {
                if (!newUser.firstName || !newUser.email || !newUser.password) return;
                
                try {
                    const response = await fetch('/api/users', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newUser)
                    });
                    
                    if (response.ok) {
                        const user = await response.json();
                        setUsers([...users, user]);
                        setNewUser({firstName: '', lastName: '', email: '', password: '', role: 'analyst'});
                    }
                } catch (error) {
                    console.error('Error creating user:', error);
                }
            };
            
            const updateUser = async () => {
                if (!editingUser) return;
                
                try {
                    const response = await fetch(`/api/users/${editingUser.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(editingUser)
                    });
                    
                    if (response.ok) {
                        const updatedUser = await response.json();
                        setUsers(users.map(u => u.id === updatedUser.id ? updatedUser : u));
                        setEditingUser(null);
                    }
                } catch (error) {
                    console.error('Error updating user:', error);
                }
            };
            
            const deleteUser = async (userId) => {
                try {
                    const response = await fetch(`/api/users/${userId}`, { method: 'DELETE' });
                    if (response.ok) {
                        setUsers(users.filter(u => u.id !== userId));
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                }
            };
            
            const changePassword = async () => {
                if (!changingPassword || !newPassword) return;
                
                try {
                    const response = await fetch(`/api/users/${changingPassword.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({...changingPassword, password: newPassword})
                    });
                    
                    if (response.ok) {
                        const updatedUser = await response.json();
                        setUsers(users.map(u => u.id === updatedUser.id ? updatedUser : u));
                        setChangingPassword(null);
                        setNewPassword('');
                        alert('Contrase√±a actualizada exitosamente');
                    }
                } catch (error) {
                    console.error('Error changing password:', error);
                }
            };
            
            const saveReport = async (reportData) => {
                try {
                    const response = await fetch('/api/reports', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reportData)
                    });
                    
                    if (response.ok) {
                        const report = await response.json();
                        setReports([...reports, report]);
                        return report;
                    }
                } catch (error) {
                    console.error('Error saving report:', error);
                }
            };
            
            const LoginPage = () => (
                React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4' },
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl p-8 w-full max-w-md' },
                        React.createElement('div', { className: 'text-center mb-8' },
                            React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-2' }, '‚àëonte Carlo'),
                            React.createElement('p', { className: 'text-gray-600' }, 'Sistema de Simulaci√≥n'),
                            React.createElement('div', { className: 'mt-4 text-sm text-gray-500' },
                                React.createElement('p', null, 'Ingrese sus credenciales para acceder')
                            )
                        ),
                        loginError && React.createElement('div', { className: 'bg-red-100 text-red-700 p-3 rounded mb-4' }, loginError),
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('input', {
                                type: 'email',
                                placeholder: 'Email',
                                value: loginData.email,
                                onChange: (e) => setLoginData({...loginData, email: e.target.value}),
                                onInput: (e) => setLoginData({...loginData, email: e.target.value}),
                                autoComplete: 'email',
                                className: 'w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500'
                            }),
                            React.createElement('input', {
                                type: 'password',
                                placeholder: 'Contrase√±a',
                                value: loginData.password,
                                onChange: (e) => setLoginData({...loginData, password: e.target.value}),
                                onInput: (e) => setLoginData({...loginData, password: e.target.value}),
                                autoComplete: 'current-password',
                                className: 'w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500'
                            }),
                            React.createElement('button', {
                                onClick: handleLogin,
                                className: 'w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 font-semibold'
                            }, 'Iniciar Sesi√≥n')
                        )
                    )
                )
            );
            
            const Sidebar = () => (
                React.createElement('div', { className: 'w-64 bg-white shadow-lg h-full' },
                    React.createElement('div', { className: 'p-6 border-b' },
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, '‚àëonte Carlo'),
                        React.createElement('p', { className: 'text-sm text-gray-600' }, `Bienvenido, ${user?.firstName}`)
                    ),
                    React.createElement('nav', { className: 'p-4 space-y-2' },
                        ['reportes', 'proyectos', 'users', 'settings'].map(page => 
                            React.createElement('button', {
                                key: page,
                                onClick: () => setCurrentPage(page),
                                className: `w-full text-left p-3 rounded-lg ${currentPage === page ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100'}`
                            }, 
                            page === 'reportes' ? 'üìä Reportes' :
                            page === 'proyectos' ? 'üìÅ Proyectos' :
                            page === 'users' ? 'üë• Usuarios' : '‚öôÔ∏è Configuraci√≥n')
                        )
                    )
                )
            );
            
            if (currentPage === 'login') {
                return React.createElement(LoginPage);
            }
            
            return React.createElement('div', { className: 'flex h-screen bg-gray-50' },
                React.createElement(Sidebar),
                React.createElement('div', { className: 'flex-1 p-6 overflow-auto' },
                    currentPage === 'reportes' && React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold mb-6' }, 'Reportes Generados'),
                        React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow mb-6' },
                            React.createElement('div', { className: 'grid grid-cols-3 gap-4 mb-4' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Buscar por proyecto',
                                    value: searchProject,
                                    onChange: (e) => setSearchProject(e.target.value),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('input', {
                                    type: 'date',
                                    value: searchDate,
                                    onChange: (e) => setSearchDate(e.target.value),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('button', {
                                    className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                                }, 'Buscar')
                            )
                        ),
                        
                        deletedReports.length > 0 && React.createElement('div', { className: 'bg-yellow-50 p-4 rounded-xl shadow mb-6' },
                            React.createElement('h3', { className: 'font-semibold mb-3 text-yellow-800' }, 'üóëÔ∏è Reportes Eliminados (Recuperables por 24h)'),
                            React.createElement('div', { className: 'space-y-2' },
                                deletedReports.map(report => {
                                    const deletedTime = new Date(report.deletedAt);
                                    const hoursLeft = 24 - Math.floor((new Date() - deletedTime) / (1000 * 60 * 60));
                                    return React.createElement('div', { key: report.id, className: 'flex justify-between items-center bg-white p-3 rounded' },
                                        React.createElement('span', null, `${report.name} (${hoursLeft}h restantes)`),
                                        React.createElement('button', {
                                            onClick: () => recoverReport(report.id),
                                            className: 'bg-green-600 text-white px-3 py-1 rounded text-sm'
                                        }, 'Recuperar')
                                    );
                                })
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white rounded-xl shadow' },
                            React.createElement('table', { className: 'w-full' },
                                React.createElement('thead', { className: 'bg-gray-50' },
                                    React.createElement('tr', null,
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Proyecto'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Fecha'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Nombre'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Acciones')
                                    )
                                ),
                                React.createElement('tbody', null,
                                    reports.map(report => 
                                        React.createElement('tr', { key: report.id, className: 'border-t' },
                                            React.createElement('td', { className: 'p-4' }, report.project || report.projectName),
                                            React.createElement('td', { className: 'p-4' }, report.date || new Date(report.createdAt).toLocaleDateString()),
                                            React.createElement('td', { className: 'p-4' }, report.name),
                                            React.createElement('td', { className: 'p-4 space-x-2' },
                                                React.createElement('button', {
                                                    onClick: () => downloadReport(report, 'pdf'),
                                                    className: 'bg-green-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'PDF'),
                                                React.createElement('button', {
                                                    onClick: () => downloadReport(report, 'doc'),
                                                    className: 'bg-blue-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'DOC'),
                                                React.createElement('button', {
                                                    onClick: () => viewReport(report),
                                                    className: 'bg-purple-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Ver'),
                                                React.createElement('button', {
                                                    onClick: () => deleteReport(report.id),
                                                    className: 'bg-red-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Eliminar')
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        
                        viewingReport && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4' },
                            React.createElement('div', { className: 'bg-white rounded-xl p-6 w-full max-w-6xl max-h-screen overflow-auto' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-2xl font-bold' }, viewingReport.name),
                                    React.createElement('button', {
                                        onClick: () => setViewingReport(null),
                                        className: 'text-gray-500 hover:text-gray-700 text-2xl'
                                    }, '√ó')
                                ),
                                
                                React.createElement('div', { className: 'grid grid-cols-2 gap-6' },
                                    React.createElement('div', { className: 'bg-gray-50 p-4 rounded' },
                                        React.createElement('h3', { className: 'font-semibold mb-3' }, 'Informaci√≥n del Proyecto'),
                                        React.createElement('p', null, `Proyecto: ${viewingReport.project || viewingReport.projectName}`),
                                        React.createElement('p', null, `Fecha: ${viewingReport.date || new Date(viewingReport.createdAt).toLocaleDateString()}`),
                                        React.createElement('p', null, `Iteraciones: ${viewingReport.config?.iterations || 'N/A'}`),
                                        React.createElement('p', null, `Variables: ${viewingReport.variables?.length || 'N/A'}`)
                                    ),
                                    
                                    React.createElement('div', { className: 'bg-blue-50 p-4 rounded' },
                                        React.createElement('h3', { className: 'font-semibold mb-3' }, 'M√©tricas Principales'),
                                        React.createElement('p', null, `Promedio: ${viewingReport.results?.metrics?.average?.toFixed(2) || 'N/A'}`),
                                        React.createElement('p', null, `Desviaci√≥n: ${viewingReport.results?.metrics?.stdDev?.toFixed(2) || 'N/A'}`),
                                        React.createElement('p', null, `M√≠nimo: ${viewingReport.results?.metrics?.min?.toFixed(2) || 'N/A'}`),
                                        React.createElement('p', null, `M√°ximo: ${viewingReport.results?.metrics?.max?.toFixed(2) || 'N/A'}`)
                                    )
                                ),
                                
                                React.createElement('div', { className: 'mt-6 flex gap-4' },
                                    React.createElement('button', {
                                        onClick: () => downloadReport(viewingReport, 'pdf'),
                                        className: 'bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700'
                                    }, 'Descargar PDF'),
                                    React.createElement('button', {
                                        onClick: () => downloadReport(viewingReport, 'doc'),
                                        className: 'bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700'
                                    }, 'Descargar DOC'),
                                    React.createElement('button', {
                                        onClick: () => setViewingReport(null),
                                        className: 'bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700'
                                    }, 'Cerrar')
                                )
                            )
                        )
                    ),
                    currentPage === 'proyectos' && React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold mb-6' }, 'Gesti√≥n de Proyectos Monte Carlo'),
                        
                        React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow mb-6' },
                            React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Crear Nuevo Proyecto'),
                            React.createElement('div', { className: 'grid grid-cols-3 gap-4 mb-4' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Nombre del proyecto',
                                    value: newProject.name,
                                    onChange: (e) => setNewProject({...newProject, name: e.target.value}),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Descripci√≥n',
                                    value: newProject.description,
                                    onChange: (e) => setNewProject({...newProject, description: e.target.value}),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('select', {
                                    value: newProject.status,
                                    onChange: (e) => setNewProject({...newProject, status: e.target.value}),
                                    className: 'p-2 border rounded'
                                },
                                    React.createElement('option', { value: 'active' }, 'Activo'),
                                    React.createElement('option', { value: 'inactive' }, 'Inactivo')
                                )
                            ),
                            React.createElement('button', {
                                onClick: createProject,
                                className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                            }, 'Crear Proyecto')
                        ),
                        
                        React.createElement('div', { className: 'bg-white rounded-xl shadow' },
                            React.createElement('div', { className: 'p-4 border-b' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Buscar proyectos...',
                                    value: searchProject,
                                    onChange: (e) => setSearchProject(e.target.value),
                                    className: 'w-full p-2 border rounded'
                                })
                            ),
                            React.createElement('table', { className: 'w-full' },
                                React.createElement('thead', { className: 'bg-gray-50' },
                                    React.createElement('tr', null,
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Nombre'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Descripci√≥n'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Estado'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Variables'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Acciones')
                                    )
                                ),
                                React.createElement('tbody', null,
                                    projects.filter(p => p.name.toLowerCase().includes(searchProject.toLowerCase())).map(project => 
                                        React.createElement('tr', { key: project.id, className: 'border-t' },
                                            React.createElement('td', { className: 'p-4 font-semibold' }, project.name),
                                            React.createElement('td', { className: 'p-4' }, project.description || 'Sin descripci√≥n'),
                                            React.createElement('td', { className: 'p-4' },
                                                React.createElement('span', {
                                                    className: `px-2 py-1 rounded text-sm ${project.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`
                                                }, project.status === 'active' ? 'Activo' : 'Inactivo')
                                            ),
                                            React.createElement('td', { className: 'p-4' }, '0 variables'),
                                            React.createElement('td', { className: 'p-4 space-x-2' },
                                                React.createElement('button', {
                                                    onClick: () => setSelectedProject(project),
                                                    className: 'bg-blue-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Configurar'),
                                                React.createElement('button', {
                                                    onClick: () => viewProjectReport(project.name),
                                                    className: 'bg-purple-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Ver Reporte'),
                                                React.createElement('button', {
                                                    onClick: () => deleteProject(project.id),
                                                    className: 'bg-red-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Eliminar')
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        
                        selectedProject && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4' },
                            React.createElement('div', { className: 'bg-white rounded-xl p-6 w-full max-w-4xl max-h-screen overflow-auto' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-2xl font-bold' }, `Configurar: ${selectedProject.name}`),
                                    React.createElement('button', {
                                        onClick: () => setSelectedProject(null),
                                        className: 'text-gray-500 hover:text-gray-700 text-2xl'
                                    }, '√ó')
                                ),
                                
                                React.createElement('div', { className: 'mb-6' },
                                    React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Variables del Proyecto'),
                                    React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-4' },
                                        React.createElement('input', {
                                            type: 'text',
                                            placeholder: 'Nombre variable',
                                            value: newVariable.name,
                                            onChange: (e) => setNewVariable({...newVariable, name: e.target.value}),
                                            className: 'p-2 border rounded'
                                        }),
                                        React.createElement('select', {
                                            value: newVariable.type,
                                            onChange: (e) => setNewVariable({...newVariable, type: e.target.value}),
                                            className: 'p-2 border rounded'
                                        },
                                            React.createElement('option', { value: 'continua' }, 'Continua'),
                                            React.createElement('option', { value: 'discreta' }, 'Discreta')
                                        ),
                                        React.createElement('select', {
                                            value: newVariable.distribution,
                                            onChange: (e) => setNewVariable({...newVariable, distribution: e.target.value}),
                                            className: 'p-2 border rounded'
                                        },
                                            React.createElement('option', { value: 'normal' }, 'Normal'),
                                            React.createElement('option', { value: 'uniforme' }, 'Uniforme'),
                                            React.createElement('option', { value: 'triangular' }, 'Triangular')
                                        ),
                                        React.createElement('button', {
                                            onClick: () => {
                                                if (newVariable.name) {
                                                    setProjectVariables([...projectVariables, {...newVariable, id: Date.now()}]);
                                                    setNewVariable({name: '', type: 'continua', distribution: 'normal', parameters: {}});
                                                }
                                            },
                                            className: 'bg-green-600 text-white px-4 py-2 rounded'
                                        }, 'Agregar')
                                    ),
                                    
                                    projectVariables.length > 0 && React.createElement('div', { className: 'border rounded' },
                                        React.createElement('table', { className: 'w-full' },
                                            React.createElement('thead', { className: 'bg-gray-50' },
                                                React.createElement('tr', null,
                                                    React.createElement('th', { className: 'p-2 text-left' }, 'Variable'),
                                                    React.createElement('th', { className: 'p-2 text-left' }, 'Tipo'),
                                                    React.createElement('th', { className: 'p-2 text-left' }, 'Distribuci√≥n'),
                                                    React.createElement('th', { className: 'p-2 text-left' }, 'Acciones')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                projectVariables.map(variable => 
                                                    React.createElement('tr', { key: variable.id, className: 'border-t' },
                                                        React.createElement('td', { className: 'p-2' }, variable.name),
                                                        React.createElement('td', { className: 'p-2' }, variable.type),
                                                        React.createElement('td', { className: 'p-2' }, variable.distribution),
                                                        React.createElement('td', { className: 'p-2' },
                                                            React.createElement('button', {
                                                                onClick: () => setProjectVariables(projectVariables.filter(v => v.id !== variable.id)),
                                                                className: 'bg-red-600 text-white px-2 py-1 rounded text-sm'
                                                            }, 'Eliminar')
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { className: 'mb-6' },
                                    React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Configuraci√≥n de Simulaci√≥n'),
                                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'N√∫mero de Iteraciones'),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: simulationConfig.iterations,
                                                onChange: (e) => setSimulationConfig({...simulationConfig, iterations: parseInt(e.target.value)}),
                                                className: 'w-full p-2 border rounded'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Semilla Aleatoria (opcional)'),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: simulationConfig.randomSeed || '',
                                                onChange: (e) => setSimulationConfig({...simulationConfig, randomSeed: e.target.value ? parseInt(e.target.value) : null}),
                                                className: 'w-full p-2 border rounded'
                                            })
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { className: 'flex gap-4' },
                                    React.createElement('button', {
                                        onClick: async () => {
                                            if (projectVariables.length > 0) {
                                                const results = executeMonteCarloSimulation(projectVariables, simulationConfig);
                                                
                                                const reportData = {
                                                    project: selectedProject.name,
                                                    projectName: selectedProject.name,
                                                    name: `Reporte ${selectedProject.name} - ${new Date().toLocaleDateString()}`,
                                                    variables: projectVariables,
                                                    config: simulationConfig,
                                                    results: results,
                                                    charts: generateCharts(results),
                                                    reportData: {
                                                        variables: projectVariables,
                                                        config: simulationConfig,
                                                        results: results,
                                                        charts: generateCharts(results)
                                                    }
                                                };
                                                
                                                const savedReport = await saveReport(reportData);
                                                if (savedReport) {
                                                    alert(`Simulaci√≥n completada:\n- ${results.scenarios.length} escenarios generados\n- Promedio: ${results.metrics.average.toFixed(2)}\n- Desviaci√≥n: ${results.metrics.stdDev.toFixed(2)}\n\nReporte guardado en la secci√≥n Reportes`);
                                                    setSelectedProject(null);
                                                    setProjectVariables([]);
                                                }
                                            } else {
                                                alert('Debe agregar al menos una variable para ejecutar la simulaci√≥n');
                                            }
                                        },
                                        className: 'bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700'
                                    }, 'Ejecutar Simulaci√≥n'),
                                    React.createElement('button', {
                                        onClick: () => setSelectedProject(null),
                                        className: 'bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700'
                                    }, 'Cerrar')
                                )
                            )
                        )
                    ),
                    currentPage === 'users' && React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold mb-6' }, 'Usuarios'),
                        React.createElement('div', { className: 'bg-white rounded-xl shadow mb-6' },
                            React.createElement('table', { className: 'w-full' },
                                React.createElement('thead', { className: 'bg-gray-50' },
                                    React.createElement('tr', null,
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Nombre'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Email'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Rol'),
                                        React.createElement('th', { className: 'p-4 text-left' }, 'Acciones')
                                    )
                                ),
                                React.createElement('tbody', null,
                                    users.map(user => 
                                        React.createElement('tr', { key: user.id, className: 'border-t' },
                                            React.createElement('td', { className: 'p-4' }, `${user.firstName} ${user.lastName || ''}`),
                                            React.createElement('td', { className: 'p-4' }, user.email),
                                            React.createElement('td', { className: 'p-4' }, user.role),
                                            React.createElement('td', { className: 'p-4 space-x-2' },
                                                React.createElement('button', {
                                                    onClick: () => setEditingUser(user),
                                                    className: 'bg-blue-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Editar'),
                                                React.createElement('button', {
                                                    onClick: () => setChangingPassword(user),
                                                    className: 'bg-yellow-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Cambiar Contrase√±a'),
                                                React.createElement('button', {
                                                    onClick: () => deleteUser(user.id),
                                                    className: 'bg-red-600 text-white px-3 py-1 rounded text-sm'
                                                }, 'Eliminar')
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        
                        changingPassword && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4' },
                            React.createElement('div', { className: 'bg-white rounded-xl p-6 w-full max-w-md' },
                                React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, `Cambiar Contrase√±a - ${changingPassword.firstName}`),
                                React.createElement('input', {
                                    type: 'password',
                                    placeholder: 'Nueva contrase√±a',
                                    value: newPassword,
                                    onChange: (e) => setNewPassword(e.target.value),
                                    className: 'w-full p-3 border rounded mb-4'
                                }),
                                React.createElement('div', { className: 'flex gap-2' },
                                    React.createElement('button', {
                                        onClick: changePassword,
                                        className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                                    }, 'Actualizar'),
                                    React.createElement('button', {
                                        onClick: () => {
                                            setChangingPassword(null);
                                            setNewPassword('');
                                        },
                                        className: 'bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700'
                                    }, 'Cancelar')
                                )
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow' },
                            React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, editingUser ? 'Editar Usuario' : 'Crear Usuario'),
                            React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-4' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Nombre',
                                    value: editingUser ? editingUser.firstName : newUser.firstName,
                                    onChange: (e) => editingUser ? setEditingUser({...editingUser, firstName: e.target.value}) : setNewUser({...newUser, firstName: e.target.value}),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Apellido',
                                    value: editingUser ? editingUser.lastName : newUser.lastName,
                                    onChange: (e) => editingUser ? setEditingUser({...editingUser, lastName: e.target.value}) : setNewUser({...newUser, lastName: e.target.value}),
                                    className: 'p-2 border rounded'
                                })
                            ),
                            React.createElement('div', { className: 'grid grid-cols-3 gap-4 mb-4' },
                                React.createElement('input', {
                                    type: 'email',
                                    placeholder: 'Email',
                                    value: editingUser ? editingUser.email : newUser.email,
                                    onChange: (e) => editingUser ? setEditingUser({...editingUser, email: e.target.value}) : setNewUser({...newUser, email: e.target.value}),
                                    className: 'p-2 border rounded'
                                }),
                                !editingUser && React.createElement('input', {
                                    type: 'password',
                                    placeholder: 'Contrase√±a',
                                    value: newUser.password,
                                    onChange: (e) => setNewUser({...newUser, password: e.target.value}),
                                    className: 'p-2 border rounded'
                                }),
                                React.createElement('select', {
                                    value: editingUser ? editingUser.role : newUser.role,
                                    onChange: (e) => editingUser ? setEditingUser({...editingUser, role: e.target.value}) : setNewUser({...newUser, role: e.target.value}),
                                    className: 'p-2 border rounded'
                                },
                                    React.createElement('option', { value: 'analyst' }, 'Analista'),
                                    React.createElement('option', { value: 'admin' }, 'Administrador')
                                )
                            ),
                            React.createElement('div', { className: 'flex gap-2' },
                                React.createElement('button', {
                                    onClick: editingUser ? updateUser : createUser,
                                    className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                                }, editingUser ? 'Actualizar' : 'Crear'),
                                editingUser && React.createElement('button', {
                                    onClick: () => setEditingUser(null),
                                    className: 'bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700'
                                }, 'Cancelar')
                            )
                        )
                    ),
                    currentPage === 'settings' && React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold mb-6' }, 'Configuraci√≥n'),
                        React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow' },
                            React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Configuraciones del Sistema Monte Carlo'),
                            React.createElement('div', { className: 'space-y-4' },
                                React.createElement('div', { className: 'border-t pt-4' },
                                    React.createElement('h4', { className: 'font-medium mb-2' }, 'Sesi√≥n de Usuario'),
                                    React.createElement('p', { className: 'text-gray-600 mb-4' }, 'Cerrar sesi√≥n y volver al login'),
                                    React.createElement('button', {
                                        onClick: logout,
                                        className: 'bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700'
                                    }, 'üö™ Cerrar Sesi√≥n')
                                )
                            )
                        )
                    )
                )
            );
        }
        
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>